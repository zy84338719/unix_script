# 架构迁移指南

## 🔄 从旧架构迁移到新架构

本指南帮助您从原有的单一脚本架构迁移到新的模块化架构。

### 📋 迁移对照表

| 旧版本 | 新版本 | 说明 |
|--------|--------|------|
| `./install.sh` | `./main.sh` | 主程序入口 |
| `./install_quick.sh` | `./quick.sh` | 快速启动 |
| `./pm_quick.sh` | `./pm.sh` | 进程管理工具 |

### 🎯 主要变化

#### 1. 统一入口
**旧版本：**
```bash
./install.sh          # 主安装脚本
```

**新版本：**
```bash
./main.sh             # 自动检测系统并加载对应功能
./quick.sh            # 快速启动（等同于 main.sh）
```

#### 2. 进程管理
**旧版本：**
```bash
./pm_quick.sh nginx
./process_manager_tool/pm_wrapper.sh -k python
```

**新版本：**
```bash
./pm.sh nginx         # 自动选择平台版本
./pm.sh -k python     # 支持相同的参数
```

#### 3. 平台特定功能
**新增特性：**
```bash
# 直接访问 Linux 功能
cd linux && bash main.sh

# 直接访问 macOS 功能
cd macos && bash main.sh

# 直接运行特定服务安装
cd linux/services && bash node_exporter.sh
```

### 🔧 兼容性

#### 完全兼容
以下脚本保持不变，可以继续使用：
- `install.sh` - 原主安装脚本
- `install_quick.sh` - 原快速安装脚本
- `pm_quick.sh` - 原进程管理快速脚本
- 所有子目录下的脚本（`node_exporter/install.sh` 等）

#### 推荐迁移
建议逐步迁移到新版本以获得更好的体验：

1. **立即可用：** 新架构已完全可用
2. **并行运行：** 新旧版本可以同时存在
3. **逐步迁移：** 可以逐个功能迁移

### 📚 使用示例

#### 安装服务
**旧版本：**
```bash
./install.sh
# 选择 1) Node Exporter
```

**新版本：**
```bash
./main.sh
# 选择 1) Node Exporter
# 或直接运行：
cd linux/services && bash node_exporter.sh
```

#### 管理进程
**旧版本：**
```bash
./pm_quick.sh nginx
./pm_quick.sh -p 80
```

**新版本：**
```bash
./pm.sh nginx
./pm.sh -p 80
```

#### 检查状态
**新增功能：**
```bash
./main.sh
# 选择 8) 查看已安装状态
# 或直接运行：
cd linux/management && bash status_check.sh
```

### 🎉 新架构优势

1. **模块化：** 每个功能独立，易于维护
2. **平台特异性：** 针对不同系统的优化
3. **更好的错误处理：** 统一的错误处理机制
4. **代码复用：** 通用工具库减少重复代码
5. **扩展性：** 更容易添加新功能

### 🚨 注意事项

1. **环境变量：** 新架构使用环境变量传递配置
2. **路径变化：** 部分脚本路径有变化
3. **权限设置：** 确保新脚本有执行权限

### 🔍 测试迁移

运行测试脚本确保迁移成功：
```bash
./test_new_architecture.sh
```

### 📞 获取帮助

如果在迁移过程中遇到问题：

1. **查看帮助：**
   ```bash
   ./main.sh --help     # 主程序帮助
   ./pm.sh --help       # 进程管理帮助
   ```

2. **检查日志：** 新架构提供更详细的错误信息

3. **回退选项：** 随时可以回到旧版本脚本

### 📅 迁移计划

**阶段 1：熟悉新架构（建议 1-2 周）**
- 并行使用新旧版本
- 熟悉新的命令和参数

**阶段 2：逐步迁移（建议 2-4 周）**
- 将常用功能迁移到新版本
- 保留复杂功能使用旧版本

**阶段 3：完全迁移（建议 1 个月后）**
- 完全使用新架构
- 可选择删除旧版本文件

迁移完成后，您将享受到更好的用户体验和更强大的功能！
